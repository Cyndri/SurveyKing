(self.webpackChunksurvey_king=self.webpackChunksurvey_king||[]).push([[5565],{82665:function(H,E,e){"use strict";var P=e(28991),d=e(67294),D=e(39288),f=e(27029),i=function(h,v){return d.createElement(f.Z,(0,P.Z)((0,P.Z)({},h),{},{ref:v,icon:D.Z}))},O=d.forwardRef(i);E.Z=O},43471:function(H,E,e){"use strict";var P=e(28991),d=e(67294),D=e(82947),f=e(27029),i=function(h,v){return d.createElement(f.Z,(0,P.Z)((0,P.Z)({},h),{},{ref:v,icon:D.Z}))},O=d.forwardRef(i);E.Z=O},19339:function(H,E,e){"use strict";var P=e(28991),d=e(67294),D=e(10262),f=e(27029),i=function(h,v){return d.createElement(f.Z,(0,P.Z)((0,P.Z)({},h),{},{ref:v,icon:D.Z}))},O=d.forwardRef(i);E.Z=O},5966:function(H,E,e){"use strict";var P=e(28481),d=e(28991),D=e(81253),f=e(21770),i=e(55843),O=e(55241),j=e(97435),h=e(67294),v=e(8932),u=e(85893),o=["fieldProps","proFieldProps"],F=["fieldProps","proFieldProps"],y="text",z=function(r){var t=r.fieldProps,m=r.proFieldProps,T=(0,D.Z)(r,o);return(0,u.jsx)(v.Z,(0,d.Z)({valueType:y,fieldProps:t,filedConfig:{valueType:y},proFieldProps:m},T))},Q=function(r){var t=(0,f.Z)(r.open||!1,{value:r.open,onChange:r.onOpenChange}),m=(0,P.Z)(t,2),T=m[0],p=m[1];return(0,u.jsx)(i.Z.Item,{shouldUpdate:!0,noStyle:!0,children:function(_){var n,U=_.getFieldValue(r.name||[]);return(0,u.jsx)(O.Z,(0,d.Z)((0,d.Z)({getPopupContainer:function(a){return a&&a.parentNode?a.parentNode:a},onOpenChange:p,content:(0,u.jsxs)("div",{style:{padding:"4px 0"},children:[(n=r.statusRender)===null||n===void 0?void 0:n.call(r,U),r.strengthText?(0,u.jsx)("div",{style:{marginTop:10},children:(0,u.jsx)("span",{children:r.strengthText})}):null]}),overlayStyle:{width:240},placement:"rightTop"},r.popoverProps),{},{open:T,children:r.children}))}})},J=function(r){var t=r.fieldProps,m=r.proFieldProps,T=(0,D.Z)(r,F),p=(0,h.useState)(!1),N=(0,P.Z)(p,2),_=N[0],n=N[1];return t!=null&&t.statusRender&&T.name?(0,u.jsx)(Q,{name:T.name,statusRender:t==null?void 0:t.statusRender,popoverProps:t==null?void 0:t.popoverProps,strengthText:t==null?void 0:t.strengthText,open:_,onOpenChange:n,children:(0,u.jsx)("div",{children:(0,u.jsx)(v.Z,(0,d.Z)({valueType:"password",fieldProps:(0,d.Z)((0,d.Z)({},(0,j.Z)(t,["statusRender","popoverProps","strengthText"])),{},{onBlur:function(g){var a;t==null||(a=t.onBlur)===null||a===void 0||a.call(t,g),n(!1)},onClick:function(g){var a;t==null||(a=t.onClick)===null||a===void 0||a.call(t,g),n(!0)}}),proFieldProps:m,filedConfig:{valueType:y}},T))})}):(0,u.jsx)(v.Z,(0,d.Z)({valueType:"password",fieldProps:t,proFieldProps:m,filedConfig:{valueType:y}},T))},S=z;S.Password=J,S.displayName="ProFormComponent",E.Z=S},90672:function(H,E,e){"use strict";var P=e(28991),d=e(81253),D=e(67294),f=e(8932),i=e(85893),O=["fieldProps","proFieldProps"],j=function(v,u){var o=v.fieldProps,F=v.proFieldProps,y=(0,d.Z)(v,O);return(0,i.jsx)(f.Z,(0,P.Z)({ref:u,valueType:"textarea",fieldProps:o,proFieldProps:F},y))};E.Z=D.forwardRef(j)},16894:function(H,E,e){"use strict";var P=e(36863);E.ZP=P.Z},86468:function(H,E,e){"use strict";e.d(E,{lq:function(){return y},FQ:function(){return S},fl:function(){return x}});var P=e(43358),d=e(34041),D=e(20228),f=e(11382),i=e(11849),O=e(94657),j=e(93224),h=e(3980),v=e(75291),u=e(67294),o=e(85893),F=["fps","fetcher","width","className","defaultOptions","readonly","value"],y=function(t){var m=t.fps,T=m===void 0?30:m,p=t.fetcher,N=t.width,_=t.className,n=t.defaultOptions,U=t.readonly,g=t.value,a=(0,j.Z)(t,F),C=(0,u.useState)(!1),s=(0,O.Z)(C,2),B=s[0],G=s[1],R=(0,u.useState)(n||[]),M=(0,O.Z)(R,2),V=M[0],W=M[1],K=u.useRef(0),A=x(N),L=(0,h.zE)(function(Z){G(!0),W([]),K.current+=1;var c=K.current;t.fetcher(Z).then(function(l){c===K.current&&(W(l),G(!1))})},T);if(U){var I;return(0,o.jsx)(v.ZP.Item,(0,i.Z)((0,i.Z)({},a),{},{children:(0,o.jsx)("span",{children:(I=V.find(function(Z){return Z.value===g}))===null||I===void 0?void 0:I.label})}))}return(0,o.jsx)(v.ZP.Item,(0,i.Z)((0,i.Z)({},a),{},{children:(0,o.jsx)(d.Z,(0,i.Z)({showSearch:!0,placeholder:t.placeholder,filterOption:!1,onSearch:L,allowClear:!0,onFocus:function(){return L("")},onClear:function(){return L("")},loading:B,notFoundContent:B?(0,o.jsx)(f.Z,{size:"small"}):null,options:V},A))}))},z=e(62999),Q=e(54680),J=["width","className","treeData","placeholder","readonly","value"],S=function(t){var m=t.width,T=t.className,p=t.treeData,N=t.placeholder,_=t.readonly,n=t.value,U=(0,j.Z)(t,J),g=x(m);if(_){var a;return(0,o.jsx)(v.ZP.Item,(0,i.Z)((0,i.Z)({},U),{},{children:(0,o.jsx)("span",{children:(a=(0,h.hE)(p,n,"key"))===null||a===void 0?void 0:a.title})}))}return(0,o.jsx)(v.ZP.Item,(0,i.Z)((0,i.Z)({},U),{},{children:(0,o.jsx)(Q.Z,(0,i.Z)({dropdownStyle:{maxHeight:400,overflow:"auto"},treeData:p,placeholder:N,treeDefaultExpandAll:!0},g))}))};function x(r){if(!r)return{};if(typeof r=="number")return{style:{width:r}};if(typeof r=="string")return{className:"pro-field ".concat(typeof r=="string"?"pro-field-".concat(r):"")}}},79871:function(H,E,e){"use strict";e.d(E,{G:function(){return a},y:function(){return g}});var P=e(57663),d=e(71577),D=e(39428),f=e(3182),i=e(71194),O=e(50146),j=e(34792),h=e(48086),v=e(94657),u=e(83279),o=e(3980),F=e(57119),y=e(51042),z=e(16894),Q=e(9761),J=e(60780),S=e.n(J),x=e(67294),r=e(11849),t=e(86468),m=e(75291),T=e(92956),p=e(5966),N=e(90672),_=e(80582),n=e(85893),U=(0,_.Pi)(function(C){var s=C.dept,B=C.onClose,G=C.onOk,R=(0,o.m2)(),M=(0,x.useRef)(),V=!!(s!=null&&s.id),W=R.depts,K=(0,x.useMemo)(function(){return S()(W.map(function(A){return{value:A.id,title:A.name,key:A.id,parentId:A.parentId}}),{parentProperty:"parentId",customID:"value"})},[W]);return(0,n.jsxs)(T.a,{title:V?"\u4FEE\u6539\u7EC4\u7EC7\u673A\u6784":"\u65B0\u5EFA\u7EC4\u7EC7\u673A\u6784",formRef:M,initialValues:(0,r.Z)({},s),visible:!0,drawerProps:{forceRender:!0,destroyOnClose:!0,onClose:function(){B()}},onFinish:function(){var A=(0,f.Z)((0,D.Z)().mark(function L(I){var Z;return(0,D.Z)().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,R.saveOrUpdateDept((0,r.Z)((0,r.Z)({},s),I));case 2:Z=l.sent,Z.success?G():h.default.error("\u4FDD\u5B58\u5931\u8D25");case 4:case"end":return l.stop()}},L)}));return function(L){return A.apply(this,arguments)}}(),children:[(0,n.jsxs)(m.ZP.Group,{children:[(!s||s&&s.id!=="1")&&W.length>0&&(0,n.jsx)(t.FQ,{name:"parentId",width:"md",treeData:K,label:"\u4E0A\u7EA7\u90E8\u95E8",placeholder:"\u8BF7\u8F93\u5165\u540D\u79F0",required:!0,value:s==null?void 0:s.id,rules:[{required:!0,message:"\u4E0A\u7EA7\u90E8\u95E8\u4E0D\u80FD\u4E3A\u7A7A"}]}),(0,n.jsx)(p.Z,{name:"code",width:"md",label:"\u7F16\u7801",placeholder:"\u8BF7\u8F93\u5165\u7F16\u7801",required:!0,rules:[{required:!0,message:"\u7F16\u7801\u4E0D\u80FD\u4E3A\u7A7A"}]})]}),(0,n.jsxs)(m.ZP.Group,{children:[(0,n.jsx)(p.Z,{name:"name",width:"md",label:"\u5168\u79F0",id:"form-name",placeholder:"\u8BF7\u8F93\u5165\u5168\u79F0",required:!0,rules:[{required:!0,message:"\u5168\u79F0\u4E0D\u80FD\u4E3A\u7A7A"}]}),(0,n.jsx)(p.Z,{name:"shortName",width:"md",label:"\u7B80\u79F0",id:"form-name",placeholder:"\u8BF7\u8F93\u5165\u7B80\u79F0",required:!0})]}),(0,n.jsx)(m.ZP.Group,{children:(0,n.jsx)(t.lq,{fps:2,name:"managerId",width:"md",label:"\u8D1F\u8D23\u4EBA",placeholder:"\u8F93\u5165\u59D3\u540D\u68C0\u7D22",value:s==null?void 0:s.managerId,defaultOptions:V?[{label:s.managerName,value:s.managerId}]:void 0,fetcher:function(L){return o.hi.loadUsers({name:L}).then(function(I){return I.list.map(function(Z){return{label:Z.name,value:Z.id}})})}})}),(0,n.jsx)(m.ZP.Group,{children:(0,n.jsx)(N.Z,{name:"remark",width:690,label:"\u5907\u6CE8",id:"form-name",placeholder:"\u8BF7\u8F93\u5165\u5907\u6CE8"})})]})});function g(C,s){var B=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"id",G=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(!s)return C;for(var R=(0,u.Z)(C);R.length;){var M=R[G?"pop":"shift"]();if(M&&M[B]===s)return[M];M!=null&&M.children&&R.push.apply(R,(0,u.Z)(M.children))}return null}var a=(0,Q.Pi)(function(C){var s=C.selectedDept,B=(0,o.m2)(),G=B.loading,R=(0,x.useRef)(),M=(0,x.useState)({visible:!1}),V=(0,v.Z)(M,2),W=V[0],K=V[1],A=g(S()(B.depts,{customID:"id",parentProperty:"parentId"}),s),L=[{title:"\u673A\u6784\u540D\u79F0",dataIndex:"name"},{title:"\u673A\u6784\u7B80\u79F0",dataIndex:"shortName",search:!1,width:200},{title:"\u8D1F\u8D23\u4EBA",dataIndex:"managerName",search:!1,width:150},{title:"\u64CD\u4F5C",valueType:"option",render:function(Z,c){return[(0,n.jsx)("a",{onClick:function(){return K({visible:!0,current:c})},children:"\u7F16\u8F91"},"edit"),(0,n.jsx)("a",{onClick:function(){if(c.children&&c.children.length>0){h.default.error("\u8BF7\u5148\u5220\u9664\u5B50\u673A\u6784\uFF01");return}O.Z.confirm({title:"\u5220\u9664",content:"\u786E\u5B9A\u5220\u9664\u5F53\u524D\u673A\u6784?",icon:(0,n.jsx)(F.Z,{}),onOk:function(){B.deleteDept(c.id)}})},children:"\u5220\u9664"},"delte")]}}];return(0,n.jsxs)("div",{children:[(0,n.jsx)(z.ZP,{columns:L,actionRef:R,loading:G,bordered:!0,dataSource:A,request:(0,f.Z)((0,D.Z)().mark(function I(){return(0,D.Z)().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:return c.abrupt("return",B.loadDepts());case 1:case"end":return c.stop()}},I)})),columnsState:{persistenceKey:"pro-table-dept",persistenceType:"localStorage"},rowKey:"id",search:!1,scroll:{x:650},pagination:!1,dateFormatter:"string",headerTitle:"\u673A\u6784\u7BA1\u7406",toolBarRender:function(){return[(0,n.jsx)(d.Z,{icon:(0,n.jsx)(y.Z,{}),type:"primary",onClick:function(){K({visible:!0})},children:"\u65B0\u5EFA"},"button")]}}),W.visible&&(0,n.jsx)(U,{onOk:function(){K({visible:!1})},dept:W.current,readonly:W.readonly,onClose:function(){return K({visible:!1})}})]})})},40017:function(H,E,e){"use strict";e.d(E,{A:function(){return U}});var P=e(58024),d=e(91894),D=e(32157),f=e(32138),i=e(34792),O=e(48086),j=e(49111),h=e(19650),v=e(22385),u=e(94199),o=e(94657),F=e(83279),y=e(3980),z=e(19339),Q=e(82665),J=e(43471),S=e(91816),x=e(86504),r=e(63258),t=e(9761),m=e(60780),T=e.n(m),p=e(67294),N=e(79871),_=e(85893);function n(g){var a=[];return g.forEach(function(C){C.children&&(a.push(C.key),a.push.apply(a,(0,F.Z)(n(C.children))))}),a}var U=(0,t.Pi)(function(g){var a=(0,y.m2)(),C=a.depts;(0,p.useEffect)(function(){a.loadDepts()},[a]);var s=(0,p.useMemo)(function(){return T()(C.map(function(c){return{title:c.name,key:c.id,parentId:c.parentId}}),{parentProperty:"parentId",customID:"key"})},[C]),B=(0,p.useState)([]),G=(0,o.Z)(B,2),R=G[0],M=G[1],V=(0,p.useState)(!0),W=(0,o.Z)(V,2),K=W[0],A=W[1],L=(0,p.useMemo)(function(){return n(s)},[s]),I=function(l){M(l),A(!1)},Z=function(l){l.length>0?g.onSelect(l[0]):g.onSelect(void 0)};return(0,_.jsx)(d.Z,{title:"\u7EC4\u7EC7\u673A\u6784",extra:(0,_.jsx)(_.Fragment,{children:(0,_.jsxs)(h.Z,{children:[R.length>0?(0,_.jsx)(u.Z,{title:"\u6298\u53E0\u6240\u6709",children:(0,_.jsx)(z.Z,{style:{cursor:"pointer"},onClick:function(){return M([])}})}):(0,_.jsx)(u.Z,{title:"\u5C55\u5F00\u6240\u6709",children:(0,_.jsx)(Q.Z,{style:{cursor:"pointer"},onClick:function(){return M(L)}})}),(0,_.jsx)(u.Z,{title:"\u5237\u65B0",children:(0,_.jsx)(J.Z,{style:{cursor:"pointer"},onClick:function(){return a.loadDepts()}})})]})}),children:(0,_.jsx)(f.Z,{expandedKeys:R,onExpand:I,draggable:!0,autoExpandParent:K,onSelect:Z,showIcon:!0,treeData:s,onDrop:function(l){if(l.dragNode.pos!=="".concat(l.node.pos,"-0")){if(l.node.parentId!==l.dragNode.parentId&&l.dragNode.parentId!==l.node.key){O.default.error("\u53EA\u80FD\u6539\u53D8\u540C\u7EA7\u673A\u6784\u7684\u987A\u5E8F");return}var X=l.dragNode.parentId,k=(0,N.y)(s,X,"key");if(k){var $,Y=($=k[0].children)===null||$===void 0?void 0:$.map(function(b){return b.key}),w=l.dragNode.key,q=Y.indexOf(w);Y.splice(q,1,""),Y.splice(l.dropPosition,0,w),a.sortDept(Y.filter(function(b){return b}))}}},icon:function(l){var X=l.expanded;return X?(0,_.jsx)(S.Z,{}):!l.data.children||l.data.children.length===0?(0,_.jsx)(x.Z,{}):(0,_.jsx)(r.Z,{})}})})})},83197:function(H,E,e){"use strict";e.r(E);var P=e(13062),d=e(71230),D=e(89032),f=e(15746),i=e(94657),O=e(2048),j=e(9761),h=e(67294),v=e(79871),u=e(40017),o=e(85893),F=(0,j.Pi)(function(){var y=(0,h.useState)(),z=(0,i.Z)(y,2),Q=z[0],J=z[1];return(0,o.jsx)(O._z,{title:!1,children:(0,o.jsxs)(d.Z,{gutter:20,children:[(0,o.jsx)(f.Z,{xs:0,md:8,children:(0,o.jsx)(u.A,{onSelect:function(x){return J(x)}})}),(0,o.jsx)(f.Z,{xs:24,md:16,children:(0,o.jsx)(v.G,{selectedDept:Q})})]})})});E.default=F}}]);
