(self.webpackChunksurvey_king=self.webpackChunksurvey_king||[]).push([[17],{86468:function(ne,$,t){"use strict";t.d($,{lq:function(){return W},FQ:function(){return G},fl:function(){return B}});var j=t(43358),T=t(34041),L=t(20228),F=t(11382),M=t(11849),i=t(94657),U=t(93224),N=t(3980),K=t(82837),A=t(67294),x=t(85893),Q=["fps","fetcher","width","className","defaultOptions","readonly","value"],W=function(d){var y=d.fps,z=y===void 0?30:y,e=d.fetcher,s=d.width,r=d.className,a=d.defaultOptions,n=d.readonly,l=d.value,o=(0,U.Z)(d,Q),f=(0,A.useState)(!1),u=(0,i.Z)(f,2),c=u[0],m=u[1],Z=(0,A.useState)(a||[]),P=(0,i.Z)(Z,2),h=P[0],C=P[1],E=A.useRef(0),I=B(s),g=(0,N.zE)(function(b){m(!0),C([]),E.current+=1;var S=E.current;d.fetcher(b).then(function(v){S===E.current&&(C(v),m(!1))})},z);if(n){var p;return(0,x.jsx)(K.ZP.Item,(0,M.Z)((0,M.Z)({},o),{},{children:(0,x.jsx)("span",{children:(p=h.find(function(b){return b.value===l}))===null||p===void 0?void 0:p.label})}))}return(0,x.jsx)(K.ZP.Item,(0,M.Z)((0,M.Z)({},o),{},{children:(0,x.jsx)(T.Z,(0,M.Z)({showSearch:!0,placeholder:d.placeholder,filterOption:!1,onSearch:g,allowClear:!0,onFocus:function(){return g("")},onClear:function(){return g("")},loading:c,notFoundContent:c?(0,x.jsx)(F.Z,{size:"small"}):null,options:h},I))}))},_=t(62999),H=t(54680),J=["width","className","treeData","placeholder","readonly","value"],G=function(d){var y=d.width,z=d.className,e=d.treeData,s=d.placeholder,r=d.readonly,a=d.value,n=(0,U.Z)(d,J),l=B(y);if(r){var o;return(0,x.jsx)(K.ZP.Item,(0,M.Z)((0,M.Z)({},n),{},{children:(0,x.jsx)("span",{children:(o=(0,N.hE)(e,a,"key"))===null||o===void 0?void 0:o.title})}))}return(0,x.jsx)(K.ZP.Item,(0,M.Z)((0,M.Z)({},n),{},{children:(0,x.jsx)(H.Z,(0,M.Z)({dropdownStyle:{maxHeight:400,overflow:"auto"},treeData:e,placeholder:s,treeDefaultExpandAll:!0},l))}))};function B(D){if(!D)return{};if(typeof D=="number")return{style:{width:D}};if(typeof D=="string")return{className:"pro-field ".concat(typeof D=="string"?"pro-field-".concat(D):"")}}},79871:function(ne,$,t){"use strict";t.d($,{G:function(){return a},y:function(){return r}});var j=t(57663),T=t(71577),L=t(39428),F=t(3182),M=t(71194),i=t(50146),U=t(34792),N=t(48086),K=t(94657),A=t(83279),x=t(3980),Q=t(57119),W=t(49101),_=t(91186),H=t(9761),J=t(60780),G=t.n(J),B=t(67294),D=t(11849),d=t(86468),y=t(82837),z=t(80582),e=t(85893),s=(0,z.Pi)(function(n){var l=n.dept,o=n.onClose,f=n.onOk,u=(0,x.m2)(),c=(0,B.useRef)(),m=!!(l!=null&&l.id),Z=u.depts,P=(0,B.useMemo)(function(){return G()(Z.map(function(h){return{value:h.id,title:h.name,key:h.id,parentId:h.parentId}}),{parentProperty:"parentId",customID:"value"})},[Z]);return(0,e.jsxs)(y.aN,{title:m?"\u4FEE\u6539\u7EC4\u7EC7\u673A\u6784":"\u65B0\u5EFA\u7EC4\u7EC7\u673A\u6784",formRef:c,initialValues:(0,D.Z)({},l),visible:!0,drawerProps:{forceRender:!0,destroyOnClose:!0,onClose:function(){o()}},onFinish:function(){var h=(0,F.Z)((0,L.Z)().mark(function C(E){var I;return(0,L.Z)().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.next=2,u.saveOrUpdateDept((0,D.Z)((0,D.Z)({},l),E));case 2:I=p.sent,I.success?f():N.default.error("\u4FDD\u5B58\u5931\u8D25");case 4:case"end":return p.stop()}},C)}));return function(C){return h.apply(this,arguments)}}(),children:[(0,e.jsxs)(y.ZP.Group,{children:[(!l||l&&l.id!=="1")&&Z.length>0&&(0,e.jsx)(d.FQ,{name:"parentId",width:"md",treeData:P,label:"\u4E0A\u7EA7\u90E8\u95E8",placeholder:"\u8BF7\u8F93\u5165\u540D\u79F0",required:!0,value:l==null?void 0:l.id,rules:[{required:!0,message:"\u4E0A\u7EA7\u90E8\u95E8\u4E0D\u80FD\u4E3A\u7A7A"}]}),(0,e.jsx)(y.V,{name:"code",width:"md",label:"\u7F16\u7801",placeholder:"\u8BF7\u8F93\u5165\u7F16\u7801",required:!0,rules:[{required:!0,message:"\u7F16\u7801\u4E0D\u80FD\u4E3A\u7A7A"}]})]}),(0,e.jsxs)(y.ZP.Group,{children:[(0,e.jsx)(y.V,{name:"name",width:"md",label:"\u5168\u79F0",id:"form-name",placeholder:"\u8BF7\u8F93\u5165\u5168\u79F0",required:!0,rules:[{required:!0,message:"\u5168\u79F0\u4E0D\u80FD\u4E3A\u7A7A"}]}),(0,e.jsx)(y.V,{name:"shortName",width:"md",label:"\u7B80\u79F0",id:"form-name",placeholder:"\u8BF7\u8F93\u5165\u7B80\u79F0",required:!0})]}),(0,e.jsx)(y.ZP.Group,{children:(0,e.jsx)(d.lq,{fps:2,name:"managerId",width:"md",label:"\u8D1F\u8D23\u4EBA",placeholder:"\u8F93\u5165\u59D3\u540D\u68C0\u7D22",value:l==null?void 0:l.managerId,defaultOptions:m?[{label:l.managerName,value:l.managerId}]:void 0,fetcher:function(C){return x.hi.loadUsers({name:C}).then(function(E){return E.list.map(function(I){return{label:I.name,value:I.id}})})}})}),(0,e.jsx)(y.ZP.Group,{children:(0,e.jsx)(y.$J,{name:"remark",width:690,label:"\u5907\u6CE8",id:"form-name",placeholder:"\u8BF7\u8F93\u5165\u5907\u6CE8"})})]})});function r(n,l){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"id",f=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1;if(!l)return n;for(var u=(0,A.Z)(n);u.length;){var c=u[f?"pop":"shift"]();if(c&&c[o]===l)return[c];c!=null&&c.children&&u.push.apply(u,(0,A.Z)(c.children))}return null}var a=(0,H.Pi)(function(n){var l=n.selectedDept,o=(0,x.m2)(),f=o.loading,u=(0,B.useRef)(),c=(0,B.useState)({visible:!1}),m=(0,K.Z)(c,2),Z=m[0],P=m[1],h=r(G()(o.depts,{customID:"id",parentProperty:"parentId"}),l),C=[{title:"\u673A\u6784\u540D\u79F0",dataIndex:"name"},{title:"\u673A\u6784\u7B80\u79F0",dataIndex:"shortName",search:!1,width:200},{title:"\u8D1F\u8D23\u4EBA",dataIndex:"managerName",search:!1,width:150},{title:"\u64CD\u4F5C",valueType:"option",render:function(I,g){return[(0,e.jsx)("a",{onClick:function(){return P({visible:!0,current:g})},children:"\u7F16\u8F91"},"edit"),(0,e.jsx)("a",{onClick:function(){if(g.children&&g.children.length>0){N.default.error("\u8BF7\u5148\u5220\u9664\u5B50\u673A\u6784\uFF01");return}i.Z.confirm({title:"\u5220\u9664",content:"\u786E\u5B9A\u5220\u9664\u5F53\u524D\u673A\u6784?",icon:(0,e.jsx)(Q.Z,{}),onOk:function(){o.deleteDept(g.id)}})},children:"\u5220\u9664"},"delte")]}}];return(0,e.jsxs)("div",{children:[(0,e.jsx)(_.ZP,{columns:C,actionRef:u,loading:f,bordered:!0,dataSource:h,request:(0,F.Z)((0,L.Z)().mark(function E(){return(0,L.Z)().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:return g.abrupt("return",o.loadDepts());case 1:case"end":return g.stop()}},E)})),columnsState:{persistenceKey:"pro-table-dept",persistenceType:"localStorage"},rowKey:"id",search:!1,scroll:{x:650},pagination:!1,dateFormatter:"string",headerTitle:"\u673A\u6784\u7BA1\u7406",toolBarRender:function(){return[(0,e.jsx)(T.Z,{icon:(0,e.jsx)(W.Z,{}),type:"primary",onClick:function(){P({visible:!0})},children:"\u65B0\u5EFA"},"button")]}}),Z.visible&&(0,e.jsx)(s,{onOk:function(){P({visible:!1})},dept:Z.current,readonly:Z.readonly,onClose:function(){return P({visible:!1})}})]})})},40017:function(ne,$,t){"use strict";t.d($,{A:function(){return n}});var j=t(58024),T=t(91894),L=t(32157),F=t(32138),M=t(34792),i=t(48086),U=t(49111),N=t(19650),K=t(22385),A=t(94199),x=t(94657),Q=t(83279),W=t(3980),_=t(81162),H=t(17828),J=t(59879),G=t(91816),B=t(86504),D=t(63258),d=t(9761),y=t(60780),z=t.n(y),e=t(67294),s=t(79871),r=t(85893);function a(l){var o=[];return l.forEach(function(f){f.children&&(o.push(f.key),o.push.apply(o,(0,Q.Z)(a(f.children))))}),o}var n=(0,d.Pi)(function(l){var o=(0,W.m2)(),f=o.depts;(0,e.useEffect)(function(){o.loadDepts()},[o]);var u=(0,e.useMemo)(function(){return z()(f.map(function(S){return{title:S.name,key:S.id,parentId:S.parentId}}),{parentProperty:"parentId",customID:"key"})},[f]),c=(0,e.useState)([]),m=(0,x.Z)(c,2),Z=m[0],P=m[1],h=(0,e.useState)(!0),C=(0,x.Z)(h,2),E=C[0],I=C[1],g=(0,e.useMemo)(function(){return a(u)},[u]),p=function(v){P(v),I(!1)},b=function(v){v.length>0?l.onSelect(v[0]):l.onSelect(void 0)};return(0,r.jsx)(T.Z,{title:"\u7EC4\u7EC7\u673A\u6784",extra:(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)(N.Z,{children:[Z.length>0?(0,r.jsx)(A.Z,{title:"\u6298\u53E0\u6240\u6709",children:(0,r.jsx)(_.Z,{style:{cursor:"pointer"},onClick:function(){return P([])}})}):(0,r.jsx)(A.Z,{title:"\u5C55\u5F00\u6240\u6709",children:(0,r.jsx)(H.Z,{style:{cursor:"pointer"},onClick:function(){return P(g)}})}),(0,r.jsx)(A.Z,{title:"\u5237\u65B0",children:(0,r.jsx)(J.Z,{style:{cursor:"pointer"},onClick:function(){return o.loadDepts()}})})]})}),children:(0,r.jsx)(F.Z,{expandedKeys:Z,onExpand:p,draggable:!0,autoExpandParent:E,onSelect:b,showIcon:!0,treeData:u,onDrop:function(v){if(v.dragNode.pos!=="".concat(v.node.pos,"-0")){if(v.node.parentId!==v.dragNode.parentId&&v.dragNode.parentId!==v.node.key){i.default.error("\u53EA\u80FD\u6539\u53D8\u540C\u7EA7\u673A\u6784\u7684\u987A\u5E8F");return}var k=v.dragNode.parentId,w=(0,s.y)(u,k,"key");if(w){var X,R=(X=w[0].children)===null||X===void 0?void 0:X.map(function(ee){return ee.key}),q=v.dragNode.key,ae=R.indexOf(q);R.splice(ae,1,""),R.splice(v.dropPosition,0,q),o.sortDept(R.filter(function(ee){return ee}))}}},icon:function(v){var k=v.expanded;return k?(0,r.jsx)(G.Z,{}):!v.data.children||v.data.children.length===0?(0,r.jsx)(B.Z,{}):(0,r.jsx)(D.Z,{})}})})})},91894:function(ne,$,t){"use strict";t.d($,{Z:function(){return z}});var j=t(96156),T=t(22122),L=t(94184),F=t.n(L),M=t(98423),i=t(67294),U=t(53124),N=t(97647),K=t(90860),A=t(38222),x=function(e,s){var r={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&s.indexOf(a)<0&&(r[a]=e[a]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,a=Object.getOwnPropertySymbols(e);n<a.length;n++)s.indexOf(a[n])<0&&Object.prototype.propertyIsEnumerable.call(e,a[n])&&(r[a[n]]=e[a[n]]);return r},Q=function(s){var r=s.prefixCls,a=s.className,n=s.hoverable,l=n===void 0?!0:n,o=x(s,["prefixCls","className","hoverable"]);return i.createElement(U.C,null,function(f){var u=f.getPrefixCls,c=u("card",r),m=F()("".concat(c,"-grid"),a,(0,j.Z)({},"".concat(c,"-grid-hoverable"),l));return i.createElement("div",(0,T.Z)({},o,{className:m}))})},W=Q,_=function(e,s){var r={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&s.indexOf(a)<0&&(r[a]=e[a]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,a=Object.getOwnPropertySymbols(e);n<a.length;n++)s.indexOf(a[n])<0&&Object.prototype.propertyIsEnumerable.call(e,a[n])&&(r[a[n]]=e[a[n]]);return r};function H(e){var s=e.map(function(r,a){return i.createElement("li",{style:{width:"".concat(100/e.length,"%")},key:"action-".concat(a)},i.createElement("span",null,r))});return s}var J=i.forwardRef(function(e,s){var r,a,n=i.useContext(U.E_),l=n.getPrefixCls,o=n.direction,f=i.useContext(N.Z),u=function(V){var Y;(Y=e.onTabChange)===null||Y===void 0||Y.call(e,V)},c=function(){var V;return i.Children.forEach(e.children,function(Y){Y&&Y.type&&Y.type===W&&(V=!0)}),V},m=e.prefixCls,Z=e.className,P=e.extra,h=e.headStyle,C=h===void 0?{}:h,E=e.bodyStyle,I=E===void 0?{}:E,g=e.title,p=e.loading,b=e.bordered,S=b===void 0?!0:b,v=e.size,k=e.type,w=e.cover,X=e.actions,R=e.tabList,q=e.children,ae=e.activeTabKey,ee=e.defaultActiveTabKey,de=e.tabBarExtraContent,ue=e.hoverable,re=e.tabProps,ce=re===void 0?{}:re,ve=_(e,["prefixCls","className","extra","headStyle","bodyStyle","title","loading","bordered","size","type","cover","actions","tabList","children","activeTabKey","defaultActiveTabKey","tabBarExtraContent","hoverable","tabProps"]),O=l("card",m),fe=i.createElement(K.Z,{loading:!0,active:!0,paragraph:{rows:4},title:!1},q),le=ae!==void 0,me=(0,T.Z)((0,T.Z)({},ce),(r={},(0,j.Z)(r,le?"activeKey":"defaultActiveKey",le?ae:ee),(0,j.Z)(r,"tabBarExtraContent",de),r)),oe,se=R&&R.length?i.createElement(A.Z,(0,T.Z)({size:"large"},me,{className:"".concat(O,"-head-tabs"),onChange:u,items:R.map(function(te){var V;return{label:te.tab,key:te.key,disabled:(V=te.disabled)!==null&&V!==void 0?V:!1}})})):null;(g||P||se)&&(oe=i.createElement("div",{className:"".concat(O,"-head"),style:C},i.createElement("div",{className:"".concat(O,"-head-wrapper")},g&&i.createElement("div",{className:"".concat(O,"-head-title")},g),P&&i.createElement("div",{className:"".concat(O,"-extra")},P)),se));var he=w?i.createElement("div",{className:"".concat(O,"-cover")},w):null,ye=i.createElement("div",{className:"".concat(O,"-body"),style:I},p?fe:q),Ee=X&&X.length?i.createElement("ul",{className:"".concat(O,"-actions")},H(X)):null,ge=(0,M.Z)(ve,["onTabChange"]),ie=v||f,Pe=F()(O,(a={},(0,j.Z)(a,"".concat(O,"-loading"),p),(0,j.Z)(a,"".concat(O,"-bordered"),S),(0,j.Z)(a,"".concat(O,"-hoverable"),ue),(0,j.Z)(a,"".concat(O,"-contain-grid"),c()),(0,j.Z)(a,"".concat(O,"-contain-tabs"),R&&R.length),(0,j.Z)(a,"".concat(O,"-").concat(ie),ie),(0,j.Z)(a,"".concat(O,"-type-").concat(k),!!k),(0,j.Z)(a,"".concat(O,"-rtl"),o==="rtl"),a),Z);return i.createElement("div",(0,T.Z)({ref:s},ge,{className:Pe}),oe,he,ye,Ee)}),G=J,B=function(e,s){var r={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&s.indexOf(a)<0&&(r[a]=e[a]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,a=Object.getOwnPropertySymbols(e);n<a.length;n++)s.indexOf(a[n])<0&&Object.prototype.propertyIsEnumerable.call(e,a[n])&&(r[a[n]]=e[a[n]]);return r},D=function(s){return i.createElement(U.C,null,function(r){var a=r.getPrefixCls,n=s.prefixCls,l=s.className,o=s.avatar,f=s.title,u=s.description,c=B(s,["prefixCls","className","avatar","title","description"]),m=a("card",n),Z=F()("".concat(m,"-meta"),l),P=o?i.createElement("div",{className:"".concat(m,"-meta-avatar")},o):null,h=f?i.createElement("div",{className:"".concat(m,"-meta-title")},f):null,C=u?i.createElement("div",{className:"".concat(m,"-meta-description")},u):null,E=h||C?i.createElement("div",{className:"".concat(m,"-meta-detail")},h,C):null;return i.createElement("div",(0,T.Z)({},c,{className:Z}),P,E)})},d=D,y=G;y.Grid=W,y.Meta=d;var z=y}}]);
