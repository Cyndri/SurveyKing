(self.webpackChunksurvey_king=self.webpackChunksurvey_king||[]).push([[5903],{5717:function(D,c){"use strict";var i={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M942.2 486.2C847.4 286.5 704.1 186 512 186c-192.2 0-335.4 100.5-430.2 300.3a60.3 60.3 0 000 51.5C176.6 737.5 319.9 838 512 838c192.2 0 335.4-100.5 430.2-300.3 7.7-16.2 7.7-35 0-51.5zM512 766c-161.3 0-279.4-81.8-362.7-254C232.6 339.8 350.7 258 512 258c161.3 0 279.4 81.8 362.7 254C791.5 684.2 673.4 766 512 766zm-4-430c-97.2 0-176 78.8-176 176s78.8 176 176 176 176-78.8 176-176-78.8-176-176-176zm0 288c-61.9 0-112-50.1-112-112s50.1-112 112-112 112 50.1 112 112-50.1 112-112 112z"}}]},name:"eye",theme:"outlined"};c.Z=i},55287:function(D,c,i){"use strict";var Q=i(28991),u=i(67294),y=i(5717),E=i(27029),l=function(_,s){return u.createElement(E.Z,(0,Q.Z)((0,Q.Z)({},_),{},{ref:s,icon:y.Z}))},g=u.forwardRef(l);c.Z=g},78210:function(D,c,i){"use strict";var Q=i(12968),u=i(20352),y=i(27856),E=i.n(y),l=i(15020),g=i(85893),B=function(s){var I=s.html,p=I===void 0?"":I,C=s.replaceP,O=C===void 0?!0:C;return O?(0,g.jsx)("div",{className:"pe-view",children:typeof p=="string"&&(0,l.ZP)(E().sanitize(p,{ADD_TAGS:["iframe"],ADD_ATTR:["allow","allowfullscreen","frameborder","scrolling"]}).replace(/<p>/,"<span>").replace(/<\/p>/,"</span>"),{replace:function(r){if((r==null?void 0:r.name)==="img"){var e=r.attribs.width;return(0,g.jsx)(u.Z,{width:e?parseFloat(e):void 0,src:r.attribs.src,style:{cursor:"zoom-in"},fallback:"data:image/png;base64,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",preview:{mask:!1}})}return r}})}):(0,g.jsx)(g.Fragment,{children:typeof p=="string"&&(0,l.ZP)(E().sanitize(p))})};c.Z=B},32235:function(D,c,i){"use strict";i.d(c,{b:function(){return O}});var Q=i(11849),u=i(39428),y=i(34792),E=i(48086),l=i(3182),g=i(69610),B=i(54941),_=i(3980),s=i(54531),I=i(36855),p=i(42238),C=i.n(p),O=function(){function w(r){var e;(0,g.Z)(this,w),this.id=void 0,this.project=void 0,this.survey=void 0,this.loading=void 0,this.verifying=!1,this.saving=!1,this.isPC=void 0,this.errorCode=void 0,this.errorMessage=void 0,this.progress=0,this.confirmTempAnswerType=0,this.statistics=void 0,this.answerUrl=void 0,this.answerQrCodeUrl=void 0,this.loginRequired=void 0,this.whitelistName=void 0,this.success=void 0,this.answerId=void 0,this.repoId=void 0,this.examExerciseType=void 0,this.answerView=void 0,this.values=void 0,this.initialQuestionScore=void 0,this.openId=void 0,this.token=void 0,this.surveyRef=void 0,this.id=r.id,this.answerId=r.answerId,this.surveyRef=r.surveyRef,this.repoId=r.repoId,this.examExerciseType=r.examExerciseType;var n=I.parse(window.location.search);n&&(this.openId=n.openId,this.token=n["sk-token"]),this.makeObservable(),this.loadProject(),this.confirmTempAnswerType=(e=this.savedAnswer)!==null&&e!==void 0&&e.progress?1:0}return(0,B.Z)(w,[{key:"makeObservable",value:function(){(0,s.Ou)(this,{id:s.LO.ref,answerId:s.LO.ref,survey:s.LO.ref,loading:s.LO.ref,saving:s.LO.ref,verifying:s.LO.ref,project:s.LO.ref,errorCode:s.LO.ref,errorMessage:s.LO.ref,progress:s.LO.ref,confirmTempAnswerType:s.LO.ref,statistics:s.LO.ref,answerUrl:s.LO.ref,answerQrCodeUrl:s.LO.ref,success:s.LO.ref,answerView:s.LO.ref,values:s.LO.ref,loginRequired:s.LO.ref,whitelistName:s.LO.ref,openId:s.LO.ref,token:s.LO.ref,passwordRequired:s.LO.computed,mode:s.LO.computed,tempSaveId:s.LO.computed,status:s.LO.computed,setting:s.LO.computed,tempSave:s.aD,saveData:s.aD,loadProject:s.aD,changeProgress:s.aD,validate:s.aD})}},{key:"setting",get:function(){var e;return(e=this.project)===null||e===void 0?void 0:e.setting}},{key:"status",get:function(){var e;return(e=this.project)===null||e===void 0?void 0:e.status}},{key:"passwordRequired",get:function(){var e;return(e=this.project)===null||e===void 0?void 0:e.passwordRequired}},{key:"mode",get:function(){var e;return(e=this.project)===null||e===void 0?void 0:e.mode}},{key:"tempSaveId",get:function(){return"savedAnswer-"+this.id}},{key:"savedAnswer",get:function(){var e=localStorage.getItem(this.tempSaveId);return e&&JSON.parse(e)}},{key:"startTime",get:function(){var e,n,t;return((e=this.savedAnswer)===null||e===void 0||(n=e.metaInfo)===null||n===void 0||(t=n.answerInfo)===null||t===void 0?void 0:t.startTime)||new Date().getTime()}},{key:"tempSave",value:function(e){var n=localStorage.getItem(this.tempSaveId),t;n?(t=JSON.parse(n),t.answer=e,t.progress=this.progress):t={answer:e,metaInfo:{answerInfo:{startTime:new Date().getTime()}},progress:this.progress},localStorage.setItem(this.tempSaveId,JSON.stringify(t))}},{key:"saveData",value:function(){var r=(0,l.Z)((0,u.Z)().mark(function n(t,a){var d,o,A=this,h,k,M,f,R,T,P,S,m;return(0,u.Z)().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(h=a||{},k=h.answerId,M=h.forceSubmit,this.saving=!0,f=new(C())().getResult(),R={answer:t,projectId:this.id,metaInfo:{answerInfo:{startTime:this.startTime,endTime:new Date().getTime()},clientInfo:{browser:f.browser.name||"",browserVersion:f.browser.version||"",deviceType:f.device.type||"",platform:f.os.name||"",platformVersion:f.os.version||""}},id:k||this.answerId,whitelistName:this.whitelistName},T=this.startTime,P=((d=this.project)===null||d===void 0||(o=d.setting.examSetting)===null||o===void 0?void 0:o.minSubmitMinutes)||0,S=T+P*60*1e3,!(P>0&&new Date().getTime()<S&&M!==!0)){v.next=11;break}return E.default.error("\u672A\u5230\u4EA4\u5377\u65F6\u95F4"),this.saving=!1,v.abrupt("return");case 11:return v.next=13,_.hi.post(this.getUrlWithToken("/api/public/saveAnswer"),R);case 13:return m=v.sent,(0,s.aD)(function(){m.success&&(m.data.answerId?A.answerId=m.data.answerId:m.data.examScore!==void 0,A.answerView=m.data,A.values=t,A.success=!0,localStorage.removeItem(A.tempSaveId)),A.saving=!1}),v.abrupt("return",m);case 16:case"end":return v.stop()}},n,this)}));function e(n,t){return r.apply(this,arguments)}return e}()},{key:"loadStatistics",value:function(){var r=(0,l.Z)((0,u.Z)().mark(function n(){var t=this,a;return(0,u.Z)().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(!this.loading){o.next=2;break}return o.abrupt("return");case 2:return this.loading=!0,o.next=5,_.hi.post(this.getUrlWithToken("/api/public/statistics"),{id:this.id});case 5:a=o.sent,(0,s.aD)(function(){a.success&&(t.statistics=a.data),t.loading=!1});case 7:case"end":return o.stop()}},n,this)}));function e(){return r.apply(this,arguments)}return e}()},{key:"loadProject",value:function(){var r=(0,l.Z)((0,u.Z)().mark(function n(){var t=this,a;return(0,u.Z)().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return this.loading=!0,o.next=3,_.hi.post(this.getUrlWithToken("/api/public/loadProject"),{id:this.id,answerId:this.answerId,repoId:this.repoId,examExerciseType:this.examExerciseType});case 3:a=o.sent,(0,s.aD)(function(){if(a.success){var A;t.project=a.data,t.loginRequired=a.data.loginRequired,t.initialQuestionScore=(A=a.data.examInfo)===null||A===void 0?void 0:A.questionScore,t.survey=a.data.survey,t.values=a.data.answer,a.data.answerId&&(t.answerId=a.data.answerId)}else t.errorMessage=a.message;t.errorCode=a.code,t.loading=!1});case 5:case"end":return o.stop()}},n,this)}));function e(){return r.apply(this,arguments)}return e}()},{key:"validate",value:function(){var r=(0,l.Z)((0,u.Z)().mark(function n(t){var a=this,d;return(0,u.Z)().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return this.verifying=!0,A.next=3,_.hi.post(this.getUrlWithToken("/api/public/validateProject"),{id:this.id,answer:t,answerId:this.answerId});case 3:d=A.sent,(0,s.aD)(function(){if(d.success){var h;a.project=d.data,a.loginRequired=!1,a.survey=d.data.survey,a.whitelistName=(h=t.whitelistName)===null||h===void 0?void 0:h.whitelistName}else E.default.error(d.message);a.verifying=!1});case 5:case"end":return A.stop()}},n,this)}));function e(n){return r.apply(this,arguments)}return e}()},{key:"upload",value:function(){var r=(0,l.Z)((0,u.Z)().mark(function n(t,a){return(0,u.Z)().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:return o.abrupt("return",_.hi.upload("/api/public/upload",(0,Q.Z)({fileType:4,basePath:this.id},t),a));case 1:case"end":return o.stop()}},n,this)}));function e(n,t){return r.apply(this,arguments)}return e}()},{key:"changeProgress",value:function(e){this.progress=e}},{key:"getUrlWithToken",value:function(e){return I.stringifyUrl({url:e,query:{"sk-token":this.token}})}}]),w}()}}]);
