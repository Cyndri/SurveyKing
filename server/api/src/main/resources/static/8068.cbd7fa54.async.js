(self.webpackChunksurvey_king=self.webpackChunksurvey_king||[]).push([[8068],{68068:function(ae,X,u){"use strict";u.d(X,{O:function(){return re},Z:function(){return Oe}});var w=u(9761),M=u(67294),G=u(13525),K=u(86052),Y=u(48187),k=u(91220),q=u(93224),Z=u(39428),T=u(83279),S=u(3182),V=u(11849),ee=u(94657),se=u(69610),ue=u(54941),_=u(3980),j=u(64031),p=u(54531);function le(l,e){}var O=u(40807),oe=["visible"],de=function(){function l(e){var n=this,i;(0,se.Z)(this,l),this.props=void 0,this.progress=0,this.form=void 0,this.pagination={current:1,pageSize:1,currentIndex:0,paginationNodes:[]},this.unmount=!1,this.notNoneInQuestionGroup=[],this.answerSheet=[],this.answerSheetVisible=!1,this.reviewAnswer={},this.autoNextPage=void 0,this.compute=void 0,this.hiddenOption={},this.visibleId=void 0,this.lazy=!1,this.preloadId=void 0;var t=e.initialValues,r=e.readOnly,a=e.fieldPermission,s=e.theme,o=e.schema,d=e.mode,h=e.onePageOneQuestion,c=h===void 0?!1:h,y=e.paginationVisible;this.props=e,this.lazy=!!e.onLazyLoad,this.initPagination(o,y,c);var m=(0,j.Np)({initialValues:t,readOnly:r,validateFirst:!0,pattern:e.pattern,effects:function(v){(0,j.dQ)(function(){if(a){var f=[],b=[];Object.entries(a).forEach(function(P){var x=(0,ee.Z)(P,2),F=x[0],E=x[1];E===0?f.push(F):E===1&&b.push(F)}),f.length>0&&m.setFieldState("*(".concat(f.join(","),")"),function(P){return P.display="none"}),b.length>0&&m.setFieldState("*(".concat(b.join(","),")"),function(P){return P.pattern="readPretty"})}n.handleFormValuesChange(),n.highlightJs(),n.setVisible(0)}),(0,j.pO)(function(f){n.handleFormValuesChange()}),(0,j.Zj)("*",function(f,b){n.handleFieldValueChange(f,b)}),le(o,v)}});this.form=m,this.answerSheet=((i=this.lazy?o.children:(0,O.Xn)(o))===null||i===void 0?void 0:i.filter(function(g){var v,f;return n.lazy||(0,O.a1)(g.type)&&((v=g.attribute)===null||v===void 0?void 0:v.display)!=="hidden"&&((f=g.attribute)===null||f===void 0?void 0:f.examAnswerMode)!=="none"}).map(function(g){var v,f=(v=e.initialQuestionScore)===null||v===void 0?void 0:v[g.id];return{finished:!1,id:g.id,marked:!1,display:n.lazy?"hidden":"visible",favorite:!!e.wrongMode,isCorrect:f===void 0?void 0:f>0}}))||[],s==="antd"&&d==="exam"&&(this.answerSheetVisible=!0),this.autoNextPage=0,e.exerciseMode&&e.onePageOneQuestion&&(this.autoNextPage=1),this.makeObservable(),this.props.correctAnswerVisible&&t&&(0,O.Xn)(o).forEach(function(g){n.computeReviewAnswer(g,t[g.id]).then(function(v){v&&(n.reviewAnswer[g.id].visible=!0)})}),this.compute=fe(function(){n.unmount||(n.lazy||n.reOrder(),n.computePagination())},10)}return(0,ue.Z)(l,[{key:"makeObservable",value:function(){(0,p.Ou)(this,{progress:p.LO.ref,pagination:p.LO,form:p.LO.ref,props:p.LO.shallow,answerSheet:p.LO,answerSheetVisible:p.LO.ref,reviewAnswer:p.LO,notNoneInQuestionGroup:p.LO,schema:p.LO.computed,autoNextPage:p.LO.ref,hiddenOption:p.LO.shallow,exerciseMode:p.LO.computed,lazy:p.LO.ref,visibleId:p.LO.ref,computeProgress:p.aD,validate:p.aD,handlePrev:p.aD,handleNext:p.aD,submit:p.aD,handleFormValuesChange:p.aD,changePageIndex:p.aD,handleFieldValueChange:p.aD,computeReviewAnswer:p.aD,reOrder:p.aD})}},{key:"schema",get:function(){return this.props.schema}},{key:"questionsGroupByPagination",get:function(){return this.pagination.paginationNodes}},{key:"exerciseMode",get:function(){return this.props.exerciseMode||!1}},{key:"initPagination",value:function(n){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:!1;i?this.pagination.paginationNodes=(0,O._T)(n,t,this.lazy):this.pagination.paginationNodes=[n.children],this.pagination.pageSize=this.pagination.paginationNodes.length}},{key:"computePagination",value:function(){if(console.log(111),this.props.paginationVisible===!1)return;var n=this.form.fields,i=this.pagination,t=i.paginationNodes,r=i.currentIndex;if(this.lazy){this.pagination=(0,V.Z)((0,V.Z)({},this.pagination),{},{pageSize:t.length,currentIndex:r,current:r+1});return}function a(c){return t[c].every(function(y){var m=n[y.id].data;return m.some(function(g){return g==="self_display"||g.startsWith("rule_")})})}for(var s=0,o=0,d=0;d<t.length;d++){var h=t[d];if(h.some(function(c){var y=n[c.id].data;return y.length===0}))o++,s++;else{if(a(d))continue;o++,d<=r&&s++}}this.pagination=(0,V.Z)((0,V.Z)({},this.pagination),{},{current:s,pageSize:o,currentIndex:r})}},{key:"highlightJs",value:function(){document.querySelectorAll(".ql-syntax").forEach(function(n){})}},{key:"validate",value:function(){var e=(0,S.Z)((0,Z.Z)().mark(function i(t){var r,a;return(0,Z.Z)().wrap(function(o){for(;;)switch(o.prev=o.next){case 0:if(a=((r=this.questionsGroupByPagination[t])===null||r===void 0?void 0:r.reduce(function(d,h){return d.push.apply(d,(0,T.Z)((0,O.Xn)(h))),d},[]))||[],a.length!==0){o.next=3;break}return o.abrupt("return",!0);case 3:return o.abrupt("return",this.form.validate("*(".concat(a.map(function(d){return d.id}).join(","),")")));case 4:case"end":return o.stop()}},i,this)}));function n(i){return e.apply(this,arguments)}return n}()},{key:"setVisible",value:function(n){var i=this;if(this.props.paginationVisible===!1)return!1;var t=this.pagination,r=t.currentIndex,a=t.paginationNodes,s=this.form.fields,o=n===void 0?r:n;function d(x){return a[x].every(function(F){var E=s[F.id].data;return E.some(function(I){return I==="self_display"||I.startsWith("rule_")})})}if(n!==void 0){if(n===r+1){var h=d(n);if(h){this.pagination.currentIndex=r+1,this.setVisible(n+1);return}}else if(n===r-1){var c=d(n);if(c){this.pagination.currentIndex=r-1,this.setVisible(n-1);return}}}if(this.lazy){var y;this.visibleId&&(s[this.visibleId].display="hidden");var m=a[o];m==null||m.forEach(function(x){s[x.id].display="visible",i.visibleId=x.id});var g=(y=a[o+1])===null||y===void 0?void 0:y[0].id;if(g){var v,f;(v=this.form)===null||v===void 0||(f=v.query(g).take())===null||f===void 0||f.setComponentProps({preload:!0})}this.compute()}else for(var b=0;b<a.length;b++){var P=a[b];b===o?P==null||P.forEach(function(x){var F=s[x.id].data;s[x.id].data=F.filter(function(E){return E!=="hidden"})}):P.forEach(function(x){var F=s[x.id].data;F.includes("hidden")||(s[x.id].data=[].concat((0,T.Z)(F),["hidden"]))})}this.pagination.currentIndex=o}},{key:"handlePrev",value:function(){var n=this.pagination.currentIndex;this.setVisible(n-1)}},{key:"handleNext",value:function(){var e=(0,S.Z)((0,Z.Z)().mark(function i(t){var r;return(0,Z.Z)().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return r=this.pagination.currentIndex,s.prev=1,s.next=4,this.validate(r);case 4:this.setVisible(r+1),setTimeout(function(){return window.scroll({top:0})},10),s.next=11;break;case 8:s.prev=8,s.t0=s.catch(1),console.log(s.t0);case 11:case"end":return s.stop()}},i,this,[[1,8]])}));function n(i){return e.apply(this,arguments)}return n}()},{key:"getPageIndexByQid",value:function(n){return this.lazy?this.questionsGroupByPagination.findIndex(function(i){return i[0].id===n}):this.questionsGroupByPagination.findIndex(function(i){return!!(i.reduce(function(t,r){return t.push.apply(t,(0,T.Z)((0,O.Xn)(r))),t},[])||[]).find(function(t){return t.id===n})})}},{key:"changePageIndex",value:function(n){var i=this.getPageIndexByQid(n);i!==-1&&(this.setVisible(i),(0,O.lA)(n,this.props.progressBar?-25:0))}},{key:"handleFormValuesChange",value:function(){var e=(0,S.Z)((0,Z.Z)().mark(function i(){return(0,Z.Z)().wrap(function(r){for(;;)switch(r.prev=r.next){case 0:this.computeProgress(),this.props.onChange&&this.props.onChange(this.form.values,this.progress);case 2:case"end":return r.stop()}},i,this)}));function n(){return e.apply(this,arguments)}return n}()},{key:"handleFieldValueChange",value:function(){var e=(0,S.Z)((0,Z.Z)().mark(function i(t,r){var a,s,o;return(0,Z.Z)().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:o=t.path.toString(),(a=(s=this.props).onFieldChange)===null||a===void 0||a.call(s,o,(0,p.ZN)(t.value)),this.props.exerciseMode&&this.computeReviewAnswer(t.componentProps.schema,t.value);case 3:case"end":return h.stop()}},i,this)}));function n(i,t){return e.apply(this,arguments)}return n}()},{key:"computeReviewAnswer",value:function(){var e=(0,S.Z)((0,Z.Z)().mark(function i(t,r){var a,s,o,d,h,c,y,m;return(0,Z.Z)().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:if(a=!1,this.props.mode!=="exam"){v.next=12;break}if(o=this.reviewAnswer[t.id]||{},d=t.type,["FillBlank","MultipleBlank","HorzBlank","Radio","Checkbox","Judge"].includes(t.type)){v.next=6;break}return v.abrupt("return");case 6:if((d==="Radio"||d==="Judge")&&(o.visible=!0),(s=t.attribute)!==null&&s!==void 0&&s.examAnswerMode&&["selectAll","selectCorrect","onlyOne","select"].includes(t.attribute.examAnswerMode)){v.next=9;break}return v.abrupt("return");case 9:a=!0,this.reviewAnswer[t.id]=t.children.reduce(function(f,b){var P,x=!!((P=b.attribute)!==null&&P!==void 0&&P.examCorrectAnswer);if(d==="FillBlank"||d==="MultipleBlank"||d==="Textarea"||d==="HorzBlank"){var F,E,I=(F=b.attribute)===null||F===void 0?void 0:F.examMatchRule,J=r==null?void 0:r[b.id],W=(E=b.attribute)===null||E===void 0?void 0:E.examCorrectAnswer;!J||!W?x=!1:I==="contain"&&J.includes(W.trim())||J===W?x=!0:x=!1}return f[b.id]={selected:!!(r!=null&&r.hasOwnProperty(b.id)),isCorrect:x},f},{visible:!!(o!=null&&o.visible)}),this.autoNextPage===1&&(h=this.reviewAnswer[t.id],c=h.visible,y=(0,q.Z)(h,oe),m=Object.values(y).filter(function(f){return f.selected&&f.isCorrect}).length===1,m&&(d==="Radio"||d==="Judge")&&this.handleNext());case 12:return v.abrupt("return",a);case 13:case"end":return v.stop()}},i,this)}));function n(i,t){return e.apply(this,arguments)}return n}()},{key:"computeProgress",value:function(){var n=this;if(!!this.props.progressBar){var i=0,t=0;if(this.lazy){var r;i=((r=this.schema.children)===null||r===void 0?void 0:r.length)||1,t=Object.keys(this.form.values).length,this.progress=t/i;return}this.form.query("*").forEach(function(a){var s=n.answerSheet.find(function(o){return o.id===a.path.toString()});a.displayName==="Field"&&!a.path.toString().startsWith("_")&&(s&&(s.display=a.display),a.data.filter(function(o){return o!=="hidden"}).length===0&&i++,!(0,O.xb)(a.value)&&a.componentProps.schema.attribute.display!=="hidden"?(t++,s&&(s.finished=!0)):s&&(s.finished=!1))}),this.progress=t/i}}},{key:"reOrder",value:function(){var n,i=this,t=1;(n=this.schema.children)===null||n===void 0||n.filter(function(r){var a;return(!(0,O.nj)(r.type)||r.type==="QuestionSet")&&((a=r.attribute)===null||a===void 0?void 0:a.examAnswerMode)!=="none"}).forEach(function(r){var a;console.log(r);var s=r.id,o=i.form.query(s).get("display");if(o!=="none"&&((a=r.attribute)===null||a===void 0?void 0:a.display)!=="hidden"){var d=i.form.query(s).take();d&&(d.setDecoratorProps((0,V.Z)((0,V.Z)({},d.decoratorProps),{},{seqNo:t})),t++);var h=1;if(r.type==="QuestionSet"){var c;(c=r.children)===null||c===void 0||c.filter(function(y){return!(0,O.nj)(y.type)}).forEach(function(y){var m=y.id,g=i.form.query(m).get("display");if(g==="visible"){var v=i.form.query(m).take();v&&(v.setDecoratorProps((0,V.Z)((0,V.Z)({},v.decoratorProps),{},{seqNo:h})),h++)}})}}})}},{key:"submit",value:function(){var e=(0,S.Z)((0,Z.Z)().mark(function i(){var t,r,a,s,o,d,h,c,y,m,g;return(0,Z.Z)().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:t="",r=this.form.query("*").map().filter(function(b){return!(0,j.JF)(b)}),a=(0,k.Z)(r),f.prev=3,a.s();case 5:if((s=a.n()).done){f.next=31;break}if(c=s.value,!(0,j.JF)(c)){f.next=9;break}return f.abrupt("continue",29);case 9:if(t=c.path.toString(),y=((o=this.props.schema.children)===null||o===void 0||(d=o.find(function(b){return b.id===t}))===null||d===void 0||(h=d.attribute)===null||h===void 0?void 0:h.display)==="hidden",!y){f.next=13;break}return f.abrupt("continue",29);case 13:if(m=c.display,m!=="none"){f.next=16;break}return f.abrupt("continue",29);case 16:return g=c.selfDisplay,c.display="visible",f.prev=18,f.next=21,c.validate();case 21:c.display=g,f.next=29;break;case 24:return f.prev=24,f.t0=f.catch(18),this.changePageIndex(t),(0,O.lA)(t,this.props.progressBar?-25:0),f.abrupt("return");case 29:f.next=5;break;case 31:f.next=36;break;case 33:f.prev=33,f.t1=f.catch(3),a.e(f.t1);case 36:return f.prev=36,a.f(),f.finish(36);case 39:return this.props.onSubmit&&this.props.onSubmit((0,p.ZN)(this.form.values)),f.abrupt("return",{values:(0,p.ZN)(this.form.values)});case 41:case"end":return f.stop()}},i,this,[[3,33,36,39],[18,24]])}));function n(){return e.apply(this,arguments)}return n}()},{key:"markQuestion",value:function(n){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,t=this.answerSheet,r=t.findIndex(function(a){return a.id===n});this.answerSheet.splice(r,1,(0,V.Z)((0,V.Z)({},t[r]),{},{marked:i}))}},{key:"favoriteQuestion",value:function(n){var i=this,t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,r=this.answerSheet,a=r.findIndex(function(s){return s.id===n.templateId});t?_.hi.createUserBook((0,V.Z)((0,V.Z)({},n),{},{type:2})).then(function(s){s.success&&i.answerSheet.splice(a,1,(0,V.Z)((0,V.Z)({},r[a]),{},{favorite:t}))}):_.hi.deleteUserBook((0,V.Z)((0,V.Z)({},n),{},{type:2})).then(function(s){s.success&&i.answerSheet.splice(a,1,(0,V.Z)((0,V.Z)({},r[a]),{},{favorite:t}))})}},{key:"cleanup",value:function(){this.unmount=!0}}]),l}();function fe(l,e,n){var i=void 0,t=void 0;return function(){var r=+new Date;t||(t=r),n&&r-t>n?(l(),t=r,window.clearTimeout(i)):(window.clearTimeout(i),i=window.setTimeout(function(){l(),t=void 0},e))}}var he=u(76826),te=u(99439),ce=u(27484),ve=u.n(ce),me=u(90019),Q=u(10192);function ge(l,e){var n,i,t=e.id,r=[];if((n=e.parent)!==null&&n!==void 0&&(i=n.type)!==null&&i!==void 0&&i.startsWith("Matrix"))if(e.parent.type==="MatrixAuto"&&Array.isArray(l))l.forEach(function(d,h){r.push(["".concat(h,"-").concat(t),d[e.id]])});else{var a;(a=e.parent.row)===null||a===void 0||a.forEach(function(d){l[d.id]?r.push(["".concat(d.id,"-").concat(t),l[d.id][e.id]]):r.push(["".concat(d.id,"-").concat(t),void 0])})}else{var s,o=(s=e.parent)===null||s===void 0?void 0:s.type;o==="Radio"||o==="Checkbox"?Object.keys(l).includes(e.id)&&r.push([e.id,l[e.id]]):r.push([e.id,l[e.id]])}return r}function ie(l){return!isNaN(parseFloat(l))&&isFinite(l)}function pe(l){return!!(ie(l)&&Number.isInteger(parseFloat(l)))}function B(l){var e=l.errMsg,n=l.schema,i=l.regEx,t=l.value;return n?C({schema:n,value:t,errMsg:e,isValid:function(a){return a?i.test("".concat(a)):!0}}):null}function ye(l){var e,n=l.schema,i=l.value,t=l.errMsg,r=((e=n.children)===null||e===void 0?void 0:e.filter(function(d){var h;return(h=d.attribute)===null||h===void 0?void 0:h.exclusiveFillBlankInMatrix}))||[],a=JSON.parse(JSON.stringify(i));Object.values(a).forEach(function(d){r.map(function(h){return h.id}).forEach(function(h){delete d[h]})});var s=!1;if(n.type==="MatrixAuto")i&&i.length>0&&(s=!0);else{var o;s=(o=n.row)===null||o===void 0?void 0:o.every(function(d){var h=a[d.id];return!(0,O.xb)(h)})}return s?null:t}function C(l){var e=l.value,n=l.schema,i=l.isValid,t=l.errMsg;return!n||!n.parent?null:ge(e,n).map(function(r){var a=(0,ee.Z)(r,2),s=a[0],o=a[1];return i(o)?null:"".concat(s,"^").concat(t)}).filter(function(r){return r})[0]}function Se(l){if(Object.keys(l).length===0)return!0}function be(l){var e=l.substring(6,8),n=l.substring(8,10),i=l.substring(10,12),t=new Date(parseFloat(e),parseFloat(n)-1,parseFloat(i));return!(t.getFullYear()-1900!==parseFloat(e)||t.getMonth()!==parseFloat(n)-1||t.getDate()!==parseFloat(i))}function Ve(l){var e=l;if(l.length!==15&&l.length!==18)return!1;if(l.length===15)return be(e);var n={11:"\u5317\u4EAC",12:"\u5929\u6D25",13:"\u6CB3\u5317",14:"\u5C71\u897F",15:"\u5185\u8499\u53E4",21:"\u8FBD\u5B81",22:"\u5409\u6797",23:"\u9ED1\u9F99\u6C5F ",31:"\u4E0A\u6D77",32:"\u6C5F\u82CF",33:"\u6D59\u6C5F",34:"\u5B89\u5FBD",35:"\u798F\u5EFA",36:"\u6C5F\u897F",37:"\u5C71\u4E1C",41:"\u6CB3\u5357",42:"\u6E56\u5317 ",43:"\u6E56\u5357",44:"\u5E7F\u4E1C",45:"\u5E7F\u897F",46:"\u6D77\u5357",50:"\u91CD\u5E86",51:"\u56DB\u5DDD",52:"\u8D35\u5DDE",53:"\u4E91\u5357",54:"\u897F\u85CF ",61:"\u9655\u897F",62:"\u7518\u8083",63:"\u9752\u6D77",64:"\u5B81\u590F",65:"\u65B0\u7586",71:"\u53F0\u6E7E",81:"\u9999\u6E2F",82:"\u6FB3\u95E8",91:"\u56FD\u5916 "},i=!0;if(!e||!/^([1-9]\d{5}(18|19|([23]\d))\d{2}((0[1-9])|(10|11|12))(([0-2][1-9])|10|20|30|31)\d{3}[0-9Xx])|([1-9]\d{5}\d{2}((0[1-9])|(10|11|12))(([0-2][1-9])|10|20|30|31)\d{2})$/i.test(e))i=!1;else if(!n[e.substr(0,2)])i=!1;else if(e.length>18)i=!1;else if(e.length===18){for(var t=e.split(""),r=[7,9,10,5,8,4,2,1,6,3,7,9,10,5,8,4,2],a=[1,0,"X",9,8,7,6,5,4,3,2],s=0,o=0,d=0,h=0;h<17;h+=1)o=parseInt(t[h],10),d=r[h],s+=o*d;var c=t[17].toUpperCase()==="X"?"X":Number(t[17]);a[s%11]!==c&&(i=!1)}return i}function A(l,e){return!!(!l||!e||(0,O.xb)(l[e.id]))}var xe={required:function(e,n){var i,t=n.schema,r=n.theme;return console.log(e),n&&n.required===!1?null:(0,O.xb)(e)?r==="antdForm"?"\u8BF7\u8F93\u5165":"\u8FD9\u9053\u9898\u672A\u56DE\u7B54":t!=null&&(i=t.type)!==null&&i!==void 0&&i.startsWith("Matrix")?ye({schema:t,errMsg:"\u95EE\u9898\u672A\u56DE\u7B54\u5B8C\u6574",value:e}):t!=null&&t.parent?C({schema:t,value:e,errMsg:"\u8FD9\u4E2A\u9009\u9879\u672A\u56DE\u7B54",isValid:function(s){var o;return(0,he.Kn)(t)&&(o=t.attribute)!==null&&o!==void 0&&o.dataType&&s===!0?!1:!(0,O.xb)(s)}}):null},answerLimit:function(e,n){var i,t=n.schema,r=t==null||(i=t.attribute)===null||i===void 0?void 0:i.answerLimit;if(!r)return null;var a=r.slice(1,r.length-1).split(","),s=parseInt(a[0]||"0"),o=parseInt(a[1]||"0"),d=Object.keys(e||{}).length;return e&&(d<s&&s!==0||d>o&&o!==0)?s===0?"\u6700\u591A\u9009\u62E9".concat(o,"\u9879"):o===0?"\u6700\u5C11\u9009\u62E9".concat(s,"\u9879"):"\u6700\u5C11\u9009\u62E9".concat(s,"\u9879,\u6700\u591A\u9009\u62E9").concat(o,"\u9879"):null},number:function(e,n){var i,t=n.schema;if(A(e,t))return null;var r=t==null||(i=t.attribute)===null||i===void 0?void 0:i.numericScale,a="\u8BF7\u8F93\u5165\u6570\u5B57";return r===0?a="\u8BF7\u8F93\u5165\u6574\u6570":r&&r>0&&(a="\u8BF7\u4FDD\u7559".concat(r,"\u4F4D\u5C0F\u6570")),C({errMsg:a,schema:t,value:e,isValid:function(o){return!(o!==void 0&&(!ie(o)||r===0&&!pe(o)||r!==void 0&&r>0&&("".concat(o).split(".")[1]||"").length>r))}})},date:function(e,n){var i,t=n.schema;if(A(e,t))return null;if(t!=null&&(i=t.attribute)!==null&&i!==void 0&&i.dateTimeFormat&&e&&e[t.id]){var r=ve()(e[t.id],t.attribute.dateTimeFormat).isValid();return r?null:"\u65E5\u671F\u683C\u5F0F\u4E0D\u6B63\u786E"}return B({errMsg:"\u8BF7\u8F93\u5165\u65E5\u671F",schema:t,regEx:/^(?:(?:1[6-9]|[2-9][0-9])[0-9]{2}([-/.]?)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:(?:1[6-9]|[2-9][0-9])(?:0[48]|[2468][048]|[13579][26])|(?:16|[2468][048]|[3579][26])00)([-/.]?)0?2\2(?:29))(\s+([01][0-9]:|2[0-3]:)?[0-5][0-9]:[0-5][0-9])?$/,value:e})},dateTime:function(e,n){var i=n.schema;return A(e,i)?null:B({errMsg:"\u8BF7\u8F93\u5165\u65E5\u671F\u65F6\u95F4",schema:i,regEx:/^\d{4}[-]([0][1-9]|(1[0-2]))[-]([1-9]|([012]\d)|(3[01]))\s(([0-1]{1}[0-9]{1})|([2]{1}[0-4]{1}))([:])(([0-5]{1}[0-9]{1}|[6]{1}[0]{1}))([:])((([0-5]{1}[0-9]{1}|[6]{1}[0]{1})))$/,value:e})},time:function(e,n){var i=n.schema;return A(e,i)?null:B({errMsg:"\u8BF7\u8F93\u5165\u65F6\u95F4",schema:i,regEx:/^(([0-1]{1}[0-9]{1})|([2]{1}[0-4]{1}))([:])(([0-5]{1}[0-9]{1}|[6]{1}[0]{1}))([:])((([0-5]{1}[0-9]{1}|[6]{1}[0]{1})))$/,value:e})},mobile:function(e,n){var i=n.schema;return A(e,i)?null:B({errMsg:"\u624B\u673A\u53F7\u683C\u5F0F\u4E0D\u6B63\u786E",schema:i,regEx:/^1[0-9]{10}$/,value:e})},decimal:function(e,n){var i=n.schema;return A(e,i)?null:B({errMsg:"\u8BF7\u8F93\u5165\u6570\u5B57",schema:i,regEx:/^[+-]?\d+(\.\d+)?$/,value:e})},email:function(e,n){var i=n.schema;return A(e,i)?null:B({errMsg:"\u90AE\u4EF6\u683C\u5F0F\u4E0D\u6B63\u786E",schema:i,regEx:/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/,value:e})},idCard:function(e,n){var i=n.schema;return A(e,i)?null:C({errMsg:"\u8EAB\u4EFD\u8BC1\u683C\u5F0F\u4E0D\u6B63\u786E",schema:i,value:e,isValid:function(r){return!(r&&!Ve("".concat(r)))}})},chinese:function(e,n){var i=n.schema;return A(e,i)?null:B({errMsg:"\u8BF7\u8F93\u5165\u6C49\u5B57",schema:i,regEx:/^[\u4e00-\u9fa5]+$/,value:e})},alphabet:function(e,n){var i=n.schema;return A(e,i)?null:B({errMsg:"\u8BF7\u8F93\u5165\u5B57\u6BCD",schema:i,regEx:/^[a-zA-Z]+$/,value:e})},textLimit:function(e,n){var i,t=n.schema;if(A(e,t))return null;var r=t==null||(i=t.attribute)===null||i===void 0?void 0:i.textLimit;if(!r)return null;var a=r.slice(1,r.length-1).split(","),s=parseInt(a[0]||"0"),o=parseInt(a[1]||"0");if(s===0&&o===0)return null;var d=C({errMsg:s!==o?"\u8BF7\u8F93\u5165".concat(s,"~").concat(o,"\u4E2A\u5B57"):"\u8BF7\u8F93\u5165".concat(s,"\u4E2A\u5B57"),schema:t,value:e,isValid:function(c){return!(c&&("".concat(c).length<s||"".concat(c).length>o))}});return d},scope:function(e,n){var i,t,r,a=n.schema,s=a==null||(i=a.attribute)===null||i===void 0?void 0:i.scope,o=a==null||(t=a.attribute)===null||t===void 0?void 0:t.dataType;if(s&&o){if(o==="number")return C({errMsg:"\u6570\u503C\u8303\u56F4\u4E0D\u6B63\u786E ".concat(s),schema:a,value:e,isValid:function(f){return!(f!==void 0&&!(0,Q.$l)(s,"".concat(f)))}});if(o==="date")return C({errMsg:"\u65E5\u671F\u8303\u56F4\u4E0D\u6B63\u786E ".concat(s),schema:a,value:e,isValid:function(f){return!(f&&!(0,Q.sm)(s,"".concat(f)))}});if(o==="dateTime")return C({errMsg:"\u65E5\u671F\u65F6\u95F4\u8303\u56F4\u4E0D\u6B63\u786E ".concat(s),schema:a,value:e,isValid:function(f){return!(f&&!(0,Q.de)(s,"".concat(f)))}});if(o==="time")return C({errMsg:"\u65F6\u95F4\u8303\u56F4\u4E0D\u6B63\u786E ".concat(s),schema:a,value:e,isValid:function(f){return!(f&&!(0,Q.YM)(s,"".concat(f)))}})}else if((a==null?void 0:a.type)==="MatrixAuto"&&(r=a.attribute)!==null&&r!==void 0&&r.scope){var d,h=(d=a.attribute)===null||d===void 0?void 0:d.scope,c=(0,Q.$l)(h,"".concat(Object.keys(e).length));if(c)return null;var y=h.substring(1,h.indexOf(",")),m=h.substring(h.indexOf(",")+1,h.length-1),g=[];return y&&g.push("\u6700\u5C11".concat(y,"\u884C")),m&&g.push("\u6700\u591A".concat(m,"\u884C")),g.join("\uFF0C")}return null},horzBlank:function(e,n){return(0,S.Z)((0,Z.Z)().mark(function i(){var t,r,a,s,o,d,h,c;return(0,Z.Z)().wrap(function(m){for(;;)switch(m.prev=m.next){case 0:if(r=n.schema,!((r==null||(t=r.attribute)===null||t===void 0?void 0:t.dataType)!=="horzBlank"||e[r.id]===void 0||!r.children||!r.parent)){m.next=3;break}return m.abrupt("return",null);case 3:a=null,s=0;case 5:if(!(s<((o=r.children)===null||o===void 0?void 0:o.length))){m.next=15;break}return d=r.children[s],h=(0,me.j)(d,r),m.next=10,(0,te.Gu)(e[r.id],h,{validateFirst:!0});case 10:c=m.sent,c.error&&c.error.length>0&&(a=c.error[0]);case 12:s++,m.next=5;break;case 15:return m.abrupt("return",a);case 16:case"end":return m.stop()}},i)}))()}};(0,te.au)(xe);var Me=u(8166),ne=u(8373),L=u(85893);window.katex=Me.Z;var re=(0,M.forwardRef)(function(l,e){var n=l.theme,i=n===void 0?Y.uH:n,t=l.footerVisible,r=t===void 0?!0:t,a=l.headerVisible,s=a===void 0?!0:a,o=l.loading,d=l.questionNumber,h=d===void 0?!0:d,c=l.onUpload,y=l.progressBar,m=y===void 0?!1:y,g=l.statistics,v=l.isPreview,f=l.mode,b=f===void 0?"survey":f,P=l.correctAnswerVisible,x=P===void 0?!1:P,F=l.examScoreVisible,E=F===void 0?!1:F,I=l.requiredVisible,J=I===void 0?!0:I,W=l.onDictSearch,Pe=l.onLink,Ze=l.triggerType,H=(0,M.useMemo)(function(){return new de(l)},[]),$=H.form,z=(0,M.useMemo)(function(){return(0,O.Gt)(l.schema)},[l.schema]),Fe=(0,M.useMemo)(function(){var N={},D=function U(R){N[R.id]=R.title,R.children&&R.children.forEach(U)};return D(z),document.title=(0,_.WO)(z.title),N},[z]),Ee=(0,M.useMemo)(function(){return(0,O.R6)(l.schema)},[l.schema]);(0,M.useImperativeHandle)(e,function(){return{submit:function(){return H.submit()},reset:function(){$.reset()},setValues:function(D){$.setValues(D,"overwrite")},setValue:function(D,U){$.setFieldState(D,function(R){return R.value=U})},toggleReadOnly:function(D){$.setState(function(U){U.pattern=D?"readPretty":"editable"})},getValues:function(){return $.values},getStore:function(){return H}}}),(0,M.useEffect)(function(){l.onInit&&l.onInit($)},[]);var Ae=(0,M.useMemo)(function(){return{theme:i,schema:z,footerVisible:r,questionNumber:h,headerVisible:s,optionTypes:Ee,onUpload:c,loading:o,id2title:Fe,progressBar:m,innerStore:H,statistics:g,isPreview:v,mode:b,correctAnswerVisible:x,examScoreVisible:E,onDictSearch:W,requiredVisible:J,onLink:Pe,triggerType:Ze}},[o,z,g]);return(0,L.jsx)(M.Suspense,{fallback:(0,L.jsx)(ne.gb,{}),children:(0,L.jsx)(ne.ZP,{theme:i,children:(0,L.jsx)(w.RV,{form:$,children:(0,L.jsx)(K.Z.Provider,{value:Ae,children:(0,L.jsx)(G.k9,{schema:z})})})})})}),Oe=re},8373:function(ae,X,u){"use strict";u.d(X,{gb:function(){return k}});var w=u(67294),M=u(85893),G=w.lazy(function(){return Promise.all([u.e(1093),u.e(9223),u.e(4221),u.e(5712),u.e(7115),u.e(7422),u.e(3074),u.e(3305),u.e(239),u.e(8613),u.e(4839),u.e(1987),u.e(3524),u.e(7856),u.e(1469),u.e(8867),u.e(1044),u.e(8684),u.e(5136),u.e(2072)]).then(u.bind(u,95771))}),K=w.lazy(function(){return Promise.all([u.e(1093),u.e(9223),u.e(4221),u.e(9548),u.e(5190),u.e(5712),u.e(7115),u.e(7422),u.e(3074),u.e(3305),u.e(8613),u.e(2765),u.e(4025),u.e(4839),u.e(1987),u.e(2664),u.e(5051),u.e(7856),u.e(1469),u.e(8867),u.e(1157),u.e(1044),u.e(9936),u.e(8684),u.e(811),u.e(2781)]).then(u.bind(u,68209))}),Y=w.lazy(function(){return Promise.all([u.e(9223),u.e(5712),u.e(7115),u.e(3074),u.e(239),u.e(2765),u.e(4839),u.e(7856),u.e(1044),u.e(9480),u.e(6598)]).then(u.bind(u,17707))}),k=function(){return(0,M.jsx)("div",{className:"page-loading-warp",children:(0,M.jsxs)("div",{className:"spinner",children:[(0,M.jsx)("div",{className:"rect1"}),(0,M.jsx)("div",{className:"rect2"}),(0,M.jsx)("div",{className:"rect3"}),(0,M.jsx)("div",{className:"rect4"}),(0,M.jsx)("div",{className:"rect5"})]})})},q=function(T){var S=T.theme,V=T.children;return S==="antdMobile"?(0,M.jsx)(K,{children:V}):S==="antdForm"?(0,M.jsx)(Y,{children:V}):(0,M.jsx)(G,{children:V})};X.ZP=q}}]);
