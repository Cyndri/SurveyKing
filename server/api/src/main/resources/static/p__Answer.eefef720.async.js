(self.webpackChunksurvey_king=self.webpackChunksurvey_king||[]).push([[6637],{91119:function(Ie,G,r){"use strict";r.r(G),r.d(G,{MobileOrPC:function(){return q},default:function(){return we}});var J=r(39428),ue=r(3182),Be=r(71194),O=r(50146),f=r(11849),le=r(68068),K=r(9761),P=r(78864),u=r(67294),Y=r(5977),ce=r(92725),k=r(12997),Me=r(49111),de=r(19650),Te=r(57663),U=r(71577),ve=r(94657),$=r(3980),fe=r(27400),me=r(73727),ge=r(49914),m=r(96389),e=r(85893),he=(0,K.Pi)(function(){var c,F,l=(0,ge.H)(),b=(0,fe.a)(),S=l.success,p=(c=l.setting)===null||c===void 0?void 0:c.submittedSetting,I=(F=l.setting)===null||F===void 0?void 0:F.answerSetting.loginRequired,d=l.survey,A=l.id,B=(0,u.useMemo)(function(){return d?(0,m.R6)(d):{}},[d]),j=p||{},y=j.contentHtml,v=j.redirectUrl,n=j.answerAnalysis,M=j.rankVisible,T=j.transcriptVisible,Q=l.answerId,_=l.answerQrCodeUrl,L=l.answerView,s=l.values;(0,u.useEffect)(function(){if(v&&s){if(!v.includes("(")){window.location.href=v;return}var C=(0,m.vW)(v,function(g){var R=(0,m.Op)(g),N=(0,ve.Z)(R,2),H=N[0],ee=N[1],W=s[H];return(0,m.d0)(B,W,g)});C.success&&(window.location.href=C.result)}},[v,s]),(0,u.useEffect)(function(){S&&d&&s&&L&&(0,m.MA)(d,y,s,L.examScore)},[y,S,d,s,L]);var V=function(){var g="";return n&&M?g="\u67E5\u770B\u6392\u540D\u53CA\u89E3\u6790":M?g="\u67E5\u770B\u8003\u8BD5\u6392\u540D":(n||T)&&(g="\u67E5\u770B\u7B54\u6848\u89E3\u6790"),g?(0,e.jsx)("div",{children:(0,e.jsx)(U.Z,{onClick:function(){return window.open("/s/".concat(A,"/exam-result/").concat(Q))},children:g})}):(0,e.jsx)(e.Fragment,{})};return S?(0,e.jsx)("div",{className:"survey-end animated",children:(0,e.jsx)("div",{className:"survey-end-content",children:(0,e.jsx)("h3",{className:"survey-end-title ",children:(0,e.jsxs)("div",{children:[(0,e.jsx)("div",{id:"result-message"}),V(),(0,e.jsx)("div",{children:I&&(0,e.jsxs)(de.Z,{children:[(0,e.jsx)(me.rU,{to:"/",children:(0,e.jsx)(U.Z,{type:"link",onClick:function(){},children:"\u8FD4\u56DE\u9996\u9875"})}),(0,e.jsx)(U.Z,{type:"link",onClick:function(){b.logout(),(0,$.on)()},children:"\u9000\u51FA\u5173\u95ED"})]})})]})})})}):(0,e.jsx)(e.Fragment,{})}),xe=he;function ye(c){return u.createElement("svg",Object.assign({width:"1em",height:"1em",viewBox:"0 0 48 48",xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink"},c,{style:Object.assign({verticalAlign:"-0.125em"},c.style),className:["antd-mobile-icon",c.className].filter(Boolean).join(" ")}),u.createElement("g",{id:"ExclamationCircleFill-ExclamationCircleFill",stroke:"none",strokeWidth:1,fill:"none",fillRule:"evenodd"},u.createElement("g",null,u.createElement("rect",{id:"ExclamationCircleFill-\u77E9\u5F62",fill:"#D76060",opacity:0,x:0,y:0,width:48,height:48}),u.createElement("path",{d:"M24,2 C36.1502645,2 46,11.8497355 46,24 C46,36.1502645 36.1502645,46 24,46 C11.8497355,46 2,36.1502645 2,24 C2,11.8497355 11.8497355,2 24,2 Z M25.1,31 L22.9,31 C22.6790861,31 22.5,31.1790861 22.5,31.4 L22.5,31.4 L22.5,33.6 C22.5,33.8209139 22.6790861,34 22.9,34 L22.9,34 L25.1,34 C25.3209139,34 25.5,33.8209139 25.5,33.6 L25.5,33.6 L25.5,31.4 C25.5,31.1790861 25.3209139,31 25.1,31 L25.1,31 Z M25.1,14 L22.9,14 C22.6790861,14 22.5,14.1790861 22.5,14.4 L22.5,14.4 L22.5,27.6 C22.5,27.8209139 22.6790861,28 22.9,28 L22.9,28 L25.1,28 C25.3209139,28 25.5,27.8209139 25.5,27.6 L25.5,27.6 L25.5,14.4 C25.5,14.1790861 25.3209139,14 25.1,14 L25.1,14 Z",id:"ExclamationCircleFill-\u5F62\u72B6\u7ED3\u5408",fill:"currentColor",fillRule:"nonzero"}))))}var Ce=ye,D=r(78210),je=r(32235),q=(0,K.Pi)(function(){var c,F,l,b,S=(0,Y.UO)(),p=S.id,I=S.answerId,d=(0,Y.TH)(),A=d.query.preview==="1",B=d.query.pattern,j=d.query.openid,y=(0,u.useMemo)(function(){return(0,m.SB)()},[]),v=(0,u.useRef)(null),n=(0,u.useMemo)(function(){return new je.b({surveyRef:v,id:p,answerId:I})},[v,p,I]),M=n.saving,T=n.loading,Q=(c=n.setting)===null||c===void 0?void 0:c.answerSetting,_=n.loginRequired,L=n.verifying,s=Q||{},V=s.autoSave,C=s.progressBar,g=s.initialValues,R=s.questionNumber,N=s.wechatOnly,H=s.onePageOneQuestion,ee=s.answerSheetVisible,W=s.triggerType,Fe=s.copyEnabled,ne=((F=n.setting)===null||F===void 0?void 0:F.examSetting)||{},Ee=ne.exerciseMode,E=ne.maxSwitchScreenTimes,Se=!!((l=n.setting)!==null&&l!==void 0&&(b=l.examSetting)!==null&&b!==void 0&&b.randomSurveyWrong),pe=n.errorMessage,z=n.savedAnswer,re=n.confirmTempAnswerType,Ze=n.statistics,Z=n.survey,te=n.answerId,ie=n.mode,ae=n.success,se=(0,m.XO)(Z,d);(0,u.useEffect)(function(){Z&&(0,m.iq)(Z,"statEnabled","quota")&&n.loadStatistics()},[Z,n]);var be=(0,u.useCallback)(function(h,a){C&&n.changeProgress(a),V&&h&&n.tempSave(h)},[C]),Ae=function(){return(0,e.jsx)(k.BW,{})};(0,u.useEffect)(function(){if(E!==void 0){var h=!1;window.onfocus=function(){h=!0},window.onblur=function(){if(!!h){var a="ebt-".concat(p),i=parseInt(localStorage.getItem(a)||"0")+1;if(i>E){var t,w=(t=v.current)===null||t===void 0?void 0:t.getValues();n.saveData((0,f.Z)((0,f.Z)({},w),{},{openid:j}),{forceSubmit:!0}).then(function(o){o!=null&&o.success&&localStorage.removeItem(a),!(o!=null&&o.success)&&o!==null&&o!==void 0&&o.message&&(y?P.u_.alert({title:"\u4FDD\u5B58\u5931\u8D25",content:(0,e.jsx)(D.Z,{html:o.message})}):O.Z.error({title:"\u4FDD\u5B58\u5931\u8D25",content:(0,e.jsx)(D.Z,{html:o.message}),okText:"\u77E5\u9053\u4E86"}))});return}console.log("lose focus ".concat(i)),y?P.u_.alert({header:(0,e.jsx)(Ce,{style:{fontSize:64,color:"var(--adm-color-warning)"}}),title:"\u6CE8\u610F",content:(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)("div",{children:["\u6700\u591A\u53EF\u4EE5\u5207\u5C4F ",E," \u6B21\uFF0C\u68C0\u6D4B\u5230\u4F60\u5DF2\u5207\u6362\u4E86 ",i," \u6B21\uFF0C\u8D85\u8FC7",E," \u6B21\u95EE\u5377\u5C06\u5F3A\u5236\u63D0\u4EA4\u3002"]})})}):O.Z.warning({title:"\u63D0\u793A",content:"\u6700\u591A\u53EF\u4EE5\u5207\u5C4F ".concat(E," \u6B21\uFF0C\u68C0\u6D4B\u5230\u4F60\u5DF2\u5207\u6362\u4E86 ").concat(i," \u6B21\uFF0C\u8D85\u8FC7 ").concat(E," \u6B21\u95EE\u5377\u5C06\u5F3A\u5236\u63D0\u4EA4\u3002"),okText:"\u6211\u77E5\u9053\u4E86"}),localStorage.setItem(a,"".concat(i))}}}},[E]);var oe=function(a){var i,t;return(0,e.jsxs)("div",{className:"render-failure ".concat(y?"mobile":"phone"),children:[((i=n.project)===null||i===void 0?void 0:i.name)&&(0,e.jsx)("div",{className:"title",children:(t=n.project)===null||t===void 0?void 0:t.name}),(0,e.jsxs)("div",{className:"content",children:[(0,e.jsx)("div",{children:(0,e.jsx)(k.AT,{})}),(0,e.jsx)("h2",{children:pe||a}),(0,e.jsx)("div",{children:"\u611F\u8C22\u5173\u6CE8\uFF01"})]})]})},Le=function(){if(ae)return(0,e.jsx)(e.Fragment,{});if(T)return(0,e.jsx)(ce.Z,{});if(n.errorCode!==200)return oe();if(N&&!(0,m.CL)())return oe("\u53EA\u80FD\u5728\u5FAE\u4FE1\u4E2D\u6253\u5F00");if(_)return(0,e.jsx)("div",{children:Ae()});if(Z&&!ae&&!L)return re===1&&V&&ie==="survey"&&!te?(0,e.jsx)(k.oq,{}):(0,e.jsx)("div",{style:{userSelect:Fe===!1?"none":"unset"},children:(0,e.jsx)(le.Z,{ref:v,mode:ie,loading:M||T,progressBar:C,questionNumber:R,theme:y?"antdMobile":"antd",schema:Z,onChange:be,onePageOneQuestion:H,answerSheetVisible:ee,exerciseMode:Ee,wrongMode:Se,pattern:B,triggerType:W,onInit:function(i){n.tempSave(i.values)},onDictSearch:function(){var a=(0,ue.Z)((0,J.Z)().mark(function i(t){var w;return(0,J.Z)().wrap(function(x){for(;;)switch(x.prev=x.next){case 0:return x.next=2,$.hi.loadDict(t);case 2:if(w=x.sent,!w.success){x.next=5;break}return x.abrupt("return",w.data);case 5:return x.abrupt("return",[]);case 6:case"end":return x.stop()}},i)}));return function(i){return a.apply(this,arguments)}}(),initialValues:re===3?se:(0,f.Z)((0,f.Z)((0,f.Z)((0,f.Z)({},g),V?z==null?void 0:z.answer:{}),se),n.values),statistics:Ze,onUpload:function(i,t){return n.upload(i,t)},footerVisible:!(A||B==="readPretty"),headerVisible:!A,isPreview:A,onLink:function(i){$.hi.loadLinkResult((0,f.Z)((0,f.Z)({},i),{},{projectId:p})).then(function(t){if(t.success&&t.data.answer){var w=t.data.answer;Object.keys(w).forEach(function(o){var x=w[o];if(i.questionId!==o){var X;(X=v.current)===null||X===void 0||X.setValue(o,x)}})}})},onSubmit:function(i){n.saveData((0,f.Z)((0,f.Z)({},i),{},{openid:j}),{answerId:te}).then(function(t){!(t!=null&&t.success)&&t!==null&&t!==void 0&&t.message&&(y?P.u_.alert({title:"\u4FDD\u5B58\u5931\u8D25",content:(0,e.jsx)(D.Z,{html:t.message})}):O.Z.error({title:"\u4FDD\u5B58\u5931\u8D25",content:(0,e.jsx)(D.Z,{html:t.message}),okText:"\u77E5\u9053\u4E86"}))})}})})},Ve=function(){return(0,e.jsx)(xe,{})},De=function(){var a,i,t=(a=n.survey)===null||a===void 0||(i=a.attribute)===null||i===void 0?void 0:i.backgroundImage;if(t)return{backgroundImage:"url(/api/public/preview/".concat(t,")")}};return(0,e.jsx)(m.ff.Provider,{value:n,children:(0,e.jsxs)("div",{className:"survey ".concat(y?"mobile":"pc"),style:De(),children:[Le(),Ve()]})})}),we=q}}]);
